inc_id: INC001
server_id: SRV_003
region: North America
date: 2025-03-03T16:22:56.789Z

# What happened?
Between 16:22 UTC on 3 March 2025, a subset of customers experienced issues when connecting to email services through our north america location. This impacted almost all customers in that region. These resources remained available for customers when connections were completed through other network paths.

# What went wrong and why?
Our global network connects the datacenters across regions with our large network of edge locations. Our edge PoP location in Toronto has paired network devices for redundancy. At 10:58 UTC one of the devices experienced hardware failures – we have since determined this to be due to a memory issue on the line cards for the device – and our automation successfully removed the device from the rotation.

While we were performing an initial investigation into the cause of device failure, at 16:22 UTC the redundant device also experienced a hardware failure, due to a similar memory issue on the line cards - the line cards restarted, and did not initialize properly after startup, to forward traffic. As the paired device had already been taken out of rotation, earlier that day, automation was not able to perform normal mitigating actions, so it required human intervention. As such, this redundant device remained in rotation and led to network packets being dropped.

During our investigation and evaluation of mitigation options, we considered failing traffic out of this PoP altogether, however this would have been particularly impactful to some customer configurations – for example, those with single-homed ExpressRoute connections – so we opted to keep the location in service. Since the hardware failure was on part of the device, our network engineers isolated the faulty line card from the device, which restored connectivity at 18:37 UTC.

After further investigation of the hardware failures, we determined the memory increases were triggered due to an increase in the number of network flows through the device, which reached a scaling limit for these line cards. These occurrences of memory exhaustion coincided with a recent unrelated datacenter network change for specific devices, which began on 27 February 2025. The change increased the routing scale, which has since been paused. We monitor for overall memory on the devices, however the memory on the line cards was not monitored specifically, which led to a delay in our overall response and mitigation processes. As such, upon our initial investigation the overall scope of impact was not evident, which delayed broad customer communications.

# How did we respond?
* 16:22 UTC on 3 March 2025 – Customer impact began, as the redundant device began experiencing the hardware failure, while the paired primary device had already been removed from rotation.
* 16:32 UTC on 3 March 2025 – Our automation attempted to bring the paired primary device back into rotation and, due to system load balancing after route convergence, the impact was marginally reduced.
* 16:43 UTC on 3 March 2025 – First automated alert raised of potential issues, however the scope of impact was not evident from the alert or initial investigations.
* 17:19 UTC on 3 March 2025 – Network engineers investigating the issue took steps to remove congestion from the network peer, which reduced impact.
* 17:27 UTC on 3 March 2025 – Additional customer reports received, following delays in submitting support requests via the Azure Portal.
* 17:46 UTC on 3 March 2025 – Additional engineering teams were engaged to investigate and mitigate.
* 17:59 UTC on 3 March 2025 – We began steps to manually remove the redundant device from rotation.
* 18:37 UTC on 3 March 2025 – We isolated the faulty line card from the device. Network traffic was shifted to healthy routes, connectivity was restored, and we monitored the service health to ensure customers had been mitigated.

# How are we making incidents like this less likely or less impactful?
* We have scanned and analyzed for the memory issue across our network. (Completed)
* We have updated the configuration on the device, to handle more connections. (Completed)
* We have added monitoring for this hardware subcomponent memory utilization, to detect issues like this more quickly. (Completed)
* We are improving our notification service for similar issues, to notify impacted customers as soon as our internal monitoring detects the issue. (Estimated completion: March 2025)
* In the longer term, we are improving our network design to handle multiple device failures in our edge PoP locations. (Estimated completion for Toronto edge: December 2025)

# How can customers make incidents like this less impactful?
* For ExpressRoute high availability, we recommend operating both primary and secondary connections of ExpressRoute circuits in active-active mode
* The impact times above represent the full incident duration, so are not specific to any individual customer. Actual impact to service availability varied between customers and resources.
* Finally, consider ensuring that the right people in your organization will be notified about any future service issues – by configuring Service Health alerts. These can trigger emails, SMS, push notifications, webhooks.
